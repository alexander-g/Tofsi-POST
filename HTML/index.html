<html>
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>Pollen Detector</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <script src="/static/thirdparty/jquery-3.4.1.min.js"></script>
  <script src="/static/thirdparty/jquery.tmpl.min.js"></script>



  <!-- fomantic UI (not semantic UI) -->
  <!--<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script>-->
  <link rel="stylesheet" href="/static/thirdparty/semantic.min.css">
<script src="/static/thirdparty/semantic.min.js"></script>


  <script src="/static/util.js">    </script>
  <script src="/static/script.js">  </script>
  <script src="/static/boxes.js">   </script>
  <script src="/static/download.js"></script>
  <script src="/static/slider.js">  </script>

  <script src="/static/thirdparty/tiff.js">  </script>
  <script src="/static/thirdparty/jszip.min.js"></script>
  


  <style type="text/css">
    .unselectable {
      user-drag: none; 
      user-select: none;
      -moz-user-select: none;
      -webkit-user-drag: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }
    </style>

  <script id="filetable-item-template" type="text/x-jQuery-tmpl">
    <tr class="ui title" filename="${filename}">
      <td> <i class="dropdown icon"></i><label>${filename}</label></td>
      <td id="detected_${filename}"></td>
      <!--<td onclick="on_flag(event);">
        <i class="flag icon" id="flag_${filename}" style="display:block; margin-left:auto; margin-right:auto;"></i>
      </td>-->
    </tr>
    <tr style="display:none">
      <td colspan="5" class="ui content" filename="${filename}">

      </td>
    </tr>
  </script>

  <script id="filelist-item-content-template" type="text/x-jQuery-tmpl">
    <div filename="${filename}">

      <div style="display:flex; justify-content:center;">
        <div class="ui image" style="width:calc(92vh - 40px); max-width:100%;">
          <div class="image-container">
            <img src="/images/${filename}.jpg?_=${time}" id="image_${filename}" style="width:100%;" class="unselectable" draggable="false" ondragstart="return false;">
            <!-- box overlays inserted here dynamically -->
          </div>
          <div class="ui top right attached label icon" style="border-top-right-radius: 0;">
            <i class="play link blue icon process-single-image" onclick="on_process_image(event)"  title="Process Image"></i>
            <i class="zoom-in icon" style="cursor:pointer; display:none;" onclick="on_zoom_button(event)" title="Zoom"></i>
            <i class="plus icon" style="cursor:pointer" onclick="on_add_custom_box_button(event)"  title="Add Custom Box"></i>
          </div>
        </div>

        <div>
          <div class="ui vertical slider" style="width:100%; min-width:100px;"></div> 
        </div>
      </div>


      <div class="ui two column stackable grid" id="patches_${filename}" style="margin:0px; display:none;"> <!-- deactivated -->
          <!-- result-details-template -->
      </div>
    </div>
  </script>

  <script id="result-details-template" type="text/x-jQuery-tmpl">
    <div class="column result-details" index="${index}" filename="${filename}">
    <div class="ui segment">
    <div class="ui top right attached label icon">
        <i class="sign in icon goto-full-image" style="cursor:pointer; display:none;" onclick="on_goto_image(event)" title="Go To Full Image"></i>
        <i class="check olive icon" style="cursor:pointer" onclick="on_accept_prediction(event)" title="Accept"></i>
        <i class="close red icon" style="cursor:pointer" onclick="on_remove_prediction(event)"  title="Remove"></i>
    </div>
    <div class="ui grid">
      <img class="ui small image six wide column" style="padding-right:0"
           src="/images/patch_${index}_${filename}.jpg?_=${time}">
      <table class="ui compact table ten wide column" style="border:0; padding:0;">
          <!--checkbox-confidence-template-->
        <tfoot class="full-width">
         <tr>
           <th class="collapsing">
              <div class="ui fitted checkbox" index="-1">
                <input type="checkbox"> <label></label>
              </div>
           </th>
           <th colspan="4" class="ui tiny form sixteen wide">
              <input type="text" class="new-label" placeholder="Other" oninput="on_custom_label_input(event)">
           </th>
         </tr>
         
        </tfoot>
      </table>
    </div>
    </div></div>
  </script>


  <script id="checkbox-confidence-template" type="text/x-jQuery-tmpl">
  <tr>
    <td class="collapsing">
      <div class="ui fitted checkbox" index="${index}">
        <input type="checkbox"> <label></label>
      </div>
    </td>
    <td class="six wide ">${label}</td>
    <td class="ten wide"><div class="ui small progress" style="margin-bottom: 0px;">
          <div class="bar"></div>
        </div>
    </td>
  </tr>
  </script>

  <script id="box-overlay-template" type="text/x-jQuery-tmpl">
    <div style="position:absolute; 
                border-style:solid; border-width:2px; border-color:#ffffff;
                top:${box[0]*100}%;        left:${box[1]*100}%; 
                bottom:${100-box[2]*100}%; right:${100-box[3]*100}%;"
         class="box-overlay" index="${index}">

      <div style="position:absolute; display:flex; top:-20px; height:20px; width:calc(100%+4px); left:-2px; right:-2px;
                  background-color:#ffffffbb; border-style:solid; border-width:0px; border-color:rgb(224,224,224);">
        
        <p onclick="convert_label_into_input(event)" data-position="left center" data-variation="mini"
           style="color:gray; user-select: none; font-weight:bold;">
          ${label}
        </p>

        <select class="ui tiny search dropdown" style="display:none; height:24px;">
          <option value="0">Other</option>
          <option value="1">Fagus</option>
          <option value="2">Alnus</option>
        </select>

        <i class="close red icon" style="cursor:pointer; margin-top:3px; margin-right:0px; margin-left:auto; padding-left:3px; visibility:hidden;" 
           title="Remove" onclick="on_remove_prediction(event)"></i>

      </div>

      

      <div class="drag-anchor move-anchor"
           style="background-color:gray; position:absolute; cursor:move; display:none;
                  top:calc(50% - 5px);      left:calc(50% - 5px);
                  height:+10px; width:10px;"></div>
      <div class="drag-anchor resize-anchor"
           style="background-color:gray; position:absolute; cursor:se-resize; display:none;
                  bottom:-5px;  right:-5px;
                  height:+10px; width:10px;"></div>
    </div>

  </script>

</head>








<body>


<div class="ui container menu">

  <div class="ui simple dropdown item">
    <span class="text">Files</span>
    <i class="dropdown icon"></i>
    <div class="ui menu">
      <label for="input_images" class="ui icon item">
        <i class="images outline icon"></i>
        Load Input Images
      </label>
      <input type="file" id="input_images" style="display:none"
            onchange="on_inputfiles_select(event)" accept="image/*" multiple>
      
      <label for="input_folder" class="ui icon item">
        <i class="folder outline icon"></i>
        Load Input Folder
      </label>
      <input type="file" id="input_folder" style="display:none"
            onchange="on_inputfolder_select(this)"  webkitdirectory directory multiple>
      
      <label class="ui icon item" onclick="on_clear_files()">
        <i class="minus square outline icon"></i>
        Clear Loaded Files
      </label>
      
      <div class="divider"></div>
      <label for="input-external-annotations" class="ui icon item">
        <i class="grey images icon"></i>
        Load Annotations
      </label>
      <input type="file" id="input-external-annotations" style="display:none" 
              onclick="this.value=null;" onchange="on_external_annotations_select(event)" 
              accept=".json" multiple>
    </div>
  </div>

  <div class="item">
  <div class="buttons">
  <label class="ui primary button" onclick="process_all()" id="process-all-button">
      <i class="play icon"></i>
      Process All Images
  </label>
  <label class="ui red button" onclick="cancel_processing()" id="cancel-processing-button" style="display:none;">
      <i class="x icon"></i>
      Cancel
  </label>
  </div>
  </div>
  

  <div class="ui secondary right menu">
    <div class="item">
      <div class="ui buttons">
      <label class="ui button has-popup" id="download-button" data-position="bottom right">
        <i class="download icon"></i>
      </label>
      <div class="ui popup transition hidden vertical menu" style="padding:0">
        <a class="item" onclick="on_download_csv()" id="download-csv-button" style="align-self:auto;margin:0px">
           Download CSV
        </a>
        <a class="item" onclick="on_download_labelme()" id="download-labelme-button" style="align-self:auto;margin:0px">
          Download LabelMe JSON
        </a>
      </div>
      <script>$('#download-button').popup({hoverable:true});</script>

      <!--<label class="ui button" onclick="on_settings()"
            id="settings-button" data-tooltip="Settings" data-position="bottom center">
        <i class="wrench icon"></i>
      </label>-->
      </div>
    </div>
  </div>
</div>


<div class="ui container" style="margin-bottom:10px">
<div class="ui styled fluid accordion" id="lowconfidence">
  <div class="title">
    <i class="dropdown icon"></i>
    <label>0 Low Confidence Predictions<label>
  </div>
  <div class="ui two column stackable grid content">

  </div>
</div>
</div>
<script>$('.accordion#lowconfidence').accordion({duration:0});</script>



<div class="ui container" style="margin-bottom:500px; padding-bottom:200px">
<table class="ui basic celled table accordion" id="filetable">
      <thead><tr>
    <th class="six wide" id="file-counter-label">Loaded Files</th>
    <th class="nine wide">Detected Pollen</th>
    <!--<th class="one wide"></th>-->
    </tr></thead>
  <tbody>
    <tr class="ui">
      <td>No Files Selected</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
<script>$('.accordion#filetable').accordion({duration:0, onOpening:on_accordion_open});</script>
<style>
.ui.table td.active, .ui.table tr.active { background: #fff!important;  }
</style>



</body>
</html>
